<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Mortgage Calculator: Buyers</title>
  <link rel="stylesheet" href="https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css" />
</head>

<body class="sans-serif">
  <div class="ma4">
    <div class="pa4">
      <div class="overflow-auto">
        <table class="f6 w-100 mw8 center" cellspacing="0">
          <thead>
            <tr class="stripe-dark">
              <th class="fw6 tl pa3 bg-white">ID</th>
              <th class="fw6 tl pa3 bg-white">Name</th>
              <th class="fw6 tl pa3 bg-white tc">Monthly Income</th>
              <th class="fw6 tl pa3 bg-white tc">Down Payment</th>
              <th class="fw6 tl pa3 bg-white tc">Budget</th>
              <th class="fw6 tl pa3 bg-white tc">Credit Grade</th>
              <th class="fw6 tl pa3 bg-white tc">Action</th>
            </tr>
          </thead>
          <tbody id="allEntries" class="lh-copy"></tbody>
        </table>
      </div>
    </div>

    <div class="tc">
      <!-- Change the API link accordingly -->
      <a href="/api/buyers" class="blue link">List of Buyers (API)</a> | <a href="https://github.com/lishure/Project2"
        class="blue link">GitHub Repo</a>
    </div>

    <script>

      const formatMoney = (amount, decimalCount = 2, decimal = '.', thousands = ',') => {
        try {
          decimalCount = Math.abs(decimalCount)
          decimalCount = isNaN(decimalCount) ? 2 : decimalCount

          const negativeSign = amount < 0 ? '-' : ''

          let i = parseInt(amount = Math.abs(Number(amount) || 0).toFixed(decimalCount)).toString()
          let j = (i.length > 3) ? i.length % 3 : 0

          return negativeSign + (j ? i.substr(0, j) + thousands : '') + i.substr(j).replace(/(\d{3})(?=\d)/g, '$1' + thousands) + (decimalCount ? decimal + Math.abs(amount - i).toFixed(decimalCount).slice(2) : '')
        } catch (e) {
          console.log(e)
        }
      }

      fetch('/api/buyers')
        .then(response => {
          return response.json()
        })
        .then(buyer => {
          for (let i = 0; i < buyer.length; i++) {
            let id = buyer[i].id
            let clientName = buyer[i].clientname
            let income = buyer[i].income
            let cashdown = buyer[i].cashdown
            let budget = buyer[i].budget
            let creditGrade = buyer[i].creditgrade

            let template =
            `
            <tr class="stripe-dark">
              <td class="pa3">${id}</td>
              <td class="pa3">${clientName}</td>
              <td class="pa3 tc">$${formatMoney(income)}</td>
              <td class="pa3 tc">$${formatMoney(cashdown)}</td>
              <td class="pa3 tc">$${formatMoney(budget)}</td>
              <td class="pa3 tc">${creditGrade}</td>
              <td class="pa3 tc">
                <a href="/edit/id:${id}" class="f6 link dim br-pill ph3 pv1 dib white bg-blue mr2">Edit</a>
                <a href="/delete/id:${id}" class="f6 link dim br-pill ph3 pv1 dib white bg-dark-red">Delete</a>
              </td>
            </tr>
            `
            const target = document.querySelector('#allEntries')
            target.innerHTML += template
          }
        })
    </script>

</body>

</html>